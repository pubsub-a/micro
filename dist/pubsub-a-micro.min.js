!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.PubSubMicro=e():t.PubSubMicro=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var i=n(1);t.exports=i["default"]},function(t,e,n){function i(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];t&&t.apply(t,e)}function r(t,e,n){void 0===e&&(e="publish"),void 0===n&&(n="subscribe");var i=new p;return t[n]=i.subscribe,t[e]=i.publish,t}var o=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},s=n(2),u=n(3),c=function(){function t(){}return t.prototype.publish=function(t,e,n){throw new Error("This method must be override by implementations")},t.prototype.subscribe=function(t,e,n){throw new Error("This method must be override by implementations")},t.prototype.once=function(t,e,n){var i,r=function(t){i.dispose(),e(t)},o=r.bind(e);return i=this.subscribe(t,o,n)},t}(),h=function(){function t(){this.subscriptionCache=new s.BucketHash}return t.prototype.start=function(t){i(t,this,void 0,void 0)},t.prototype.stop=function(t){i(t)},t.prototype.channel=function(t,e){var n=new d(t,this.subscriptionCache);return e&&e(n),n},t.includeIn=function(t,e,n){return r(t,e,n)},t}();Object.defineProperty(e,"__esModule",{value:!0}),e["default"]=h;var p=function(){function t(){var t=new h;this.channel=t.channel("__i",void 0),this.subscribe=this._subscribe.bind(this),this.publish=this._publish.bind(this)}return t.prototype._subscribe=function(t){return this.channel.subscribe("a",t)},t.prototype._publish=function(t){return this.channel.publish("a",t)},t}(),a=function(){function t(t,e){this.name=t,this.cache=e}return t.prototype.publish=function(t){for(var e=this.cache.get(this.name),n=0;n<e.length;n++)e[n](t)},t}(),f=function(){function t(t,e){this.name=t,this.cache=e}return t.prototype.subscribe=function(t){var e=this,n=this.cache.add(this.name,t),r=function(n){var r=e.cache.remove(e.name,t);return i(n,r),r};return new u.SubscriptionToken(r,n)},t}(),d=function(t){function e(e,n){t.call(this),this.name=e,this.cache=n,this.name=e}return o(e,t),e.prototype.publish=function(t,e,n){var r=new a(t,this.cache);r.publish(e),i(n,t,e)},e.prototype.subscribe=function(t,e,n){var r=new f(t,this.cache),o=r.subscribe(e);return i(n,o,t,e),o},e}(c)},function(t,e){var n=function(){function t(){this.dict={}}return t.prototype.encodeKey=function(t){return"$"+t},t.prototype.add=function(t,e){var n=this.dict,i=this.encodeKey(t);return n.hasOwnProperty(i)?(n[i].push(e),n[i].length):(n[i]=[e],1)},t.prototype.get=function(t){var e=this.encodeKey(t);return this.dict[e]||[]},t.prototype.exists=function(t){var e=this.encodeKey(t);return this.dict.hasOwnProperty(e)},t.prototype.clear=function(t){this.get(t);this.remove(t)},t.prototype.remove=function(t,e){var n,i=this.encodeKey(t),r=this.dict[i];if(!r)throw new Error("Key does not exist");if(!e)return delete this.dict[i],0;if(n=this.removeFromArray(r,e),-1===n)throw new Error("Trying to remove non-existant element from the bucket");return 0===r.length&&delete this.dict[i],r.length},t.prototype.removeFromArray=function(t,e){var n=t.indexOf(e);return n>=0&&t.splice(n,1),n},t}();e.BucketHash=n},function(t,e){var n=function(){function t(t,e){this.isDisposed=!1,this.disposeFn=t,this.count=e?e:0}return t.prototype.dispose=function(t){if(this.isDisposed)throw new Error("Subscription is already disposed");return this.isDisposed=!0,this.disposeFn(t)},t}();e.SubscriptionToken=n}])});