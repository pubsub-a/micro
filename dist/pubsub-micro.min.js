var PubSubA;!function(t){var n=function(){function t(){this.dict={}}return t.prototype.encodeKey=function(t){return"$"+t},t.prototype.add=function(t,n){var e=this.dict,r=this.encodeKey(t);return e.hasOwnProperty(r)?(e[r].push(n),e[r].length):(e[r]=[n],1)},t.prototype.get=function(t){var n=this.encodeKey(t);return this.dict[n]||[]},t.prototype.exists=function(t){var n=this.encodeKey(t);return this.dict.hasOwnProperty(n)},t.prototype.clear=function(t){this.get(t);this.remove(t)},t.prototype.remove=function(t,n){var e,r=this.encodeKey(t),i=this.dict[r];if(!i)throw new Error("Key does not exist");if(!n)return delete this.dict[r],0;if(e=this.removeFromArray(i,n),-1===e)throw new Error("Trying to remove non-existant element from the bucket");return 0===i.length&&delete this.dict[r],i.length},t.prototype.removeFromArray=function(t,n){var e=t.indexOf(n);return e>=0&&t.splice(e,1),e},t}();t.BucketHash=n}(PubSubA||(PubSubA={}));var PubSubA;!function(t){function n(t,n,r){void 0===n&&(n="publish"),void 0===r&&(r="subscribe");var i=new e;return t[r]=i.subscribe,t[n]=i.publish,t}var e=function(){function n(){var n=new t.MicroPubSub;this.channel=n.channel("__i",void 0),this.subscribe=this._subscribe.bind(this),this.publish=this._publish.bind(this)}return n.prototype._subscribe=function(t){return this.channel.subscribe("a",t)},n.prototype._publish=function(t){return this.channel.publish("a",t)},n}();t.internalIncludeIn=n}(PubSubA||(PubSubA={}));var PubSubA;!function(t){function n(t,n){i[t]=n}function e(n,e){if(!i[n])throw new Error("Provider with name: "+n+" could not be found, did you forget to include the source?");var r=i[n];return r.call(t,e)}function r(){return i}var i=[];t.addProvider=n,t.create=e,t.getProvider=r,function(){t.addProvider("local",function(){return new t.MicroPubSub})}(),function(){t.addProvider("autobahn",function(t){})}()}(PubSubA||(PubSubA={}));var __extends=this&&this.__extends||function(t,n){function e(){this.constructor=t}for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r]);t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)},PubSubA;!function(t){function n(t){for(var n=[],e=1;e<arguments.length;e++)n[e-1]=arguments[e];t&&t.apply(t,n)}t.invokeIfDefined=n;var e=function(){function t(){}return t.prototype.publish=function(t,n,e){throw new Error("This method must be override by implementations")},t.prototype.subscribe=function(t,n,e){throw new Error("This method must be override by implementations")},t.prototype.once=function(t,n,e){var r,i=function(t){r.dispose(),n(t)},o=i.bind(n);return r=this.subscribe(t,o,e)},t}();t.ChannelStatic=e;var r=function(){function e(){this.subscriptionCache=new t.BucketHash}return e.prototype.start=function(t){n(t,this,void 0,void 0)},e.prototype.stop=function(t){n(t)},e.prototype.channel=function(t,n){var e=new u(t,this.subscriptionCache);return n&&n(e),e},e.includeIn=function(n,e,r){return t.internalIncludeIn(n,e,r)},e}();t.MicroPubSub=r;var i=function(){function t(t,n){this.name=t,this.cache=n}return t.prototype.publish=function(t){for(var n=this.cache.get(this.name),e=0;e<n.length;e++)n[e](t)},t}(),o=function(){function e(t,n){this.name=t,this.cache=n}return e.prototype.subscribe=function(e){var r=this,i=this.cache.add(this.name,e),o=function(t){var i=r.cache.remove(r.name,e);return n(t,i),i};return new t.SubscriptionToken(o,i)},e}(),u=function(t){function e(n,e){t.call(this),this.name=n,this.cache=e,this.name=n}return __extends(e,t),e.prototype.publish=function(t,e,r){var o=new i(t,this.cache);o.publish(e),n(r,t,e)},e.prototype.subscribe=function(t,e,r){var i=new o(t,this.cache),u=i.subscribe(e);return n(r,u,t,e),u},e}(e)}(PubSubA||(PubSubA={}));var PubSubA;!function(t){var n=function(){function t(t,n){this.isDisposed=!1,this.disposeFn=t,this.count=n?n:0}return t.prototype.dispose=function(t){if(this.isDisposed)throw new Error("Subscription is already disposed");return this.isDisposed=!0,this.disposeFn(t)},t}();t.SubscriptionToken=n}(PubSubA||(PubSubA={}));var PubSubA;!function(t){var n=function(){function t(){}return t.randomString=function(t){void 0===t&&(t=8);for(var n="",e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;t>r;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return n},t}();t.Util=n}(PubSubA||(PubSubA={}));